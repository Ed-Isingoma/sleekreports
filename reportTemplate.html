<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Report Template</title>
    <style>
        * {
            box-sizing: border-box;
            word-break: break-word;
        }
        button, .header, .section, .footer {
            user-select: none;
        }
        *:focus {
            outline: 3px solid rgb(0, 255, 128);
        }
        .reportPage {
            /*height: 330mm;*/
            width: 215mm;
            color: black;
            font-family: "Candara", serif;
            font-size: 17px;
            text-align: center;
        }
        .header {
            font-weight: bolder;
            width: 215mm;
            max-height: 2.7cm;
            display: inline-block;
        }
        .schLogo {
            display: block;
            width: 65px;
            margin-left: 8px;
            margin-right: 15px;
            float: left;
        }
        .holdTitl {
            float: left;
            line-height: 130%;
        }
        .firstLine {
            font-size: 24px;
        }
        .blackLine {
            height: 3px;
            width: 100%;
            margin-bottom: 2px;
            border-top: 3px solid black;
        }
        .reportIntros, .reportOutros {
            font-weight: bold;
            font-size: 19px;
            width: 205mm;
            display: inline-block;
        }
        #notif {
            text-align: left;
            font-style: italic;
        }
        .inlineB {
            display: inline-block;
        }
        .addName {
            width: 83%;
            text-align: left;
        }
        .addClass, .addGender {
            width: 34%;
            height: 15px;
            text-align: left;
        }
        .theirName, .theirClass, .gender {
            width: 15%;
            text-align: left;
        }
        .realReport, .realReport2 {
            width: 210mm;
            font-family: "Arial Narrow";
            text-align: center;
            border: 1px solid rgb(58, 58, 58);
        }
        .realReport >div, .realReport2>div, .addTopic, .addScore, .leftmost, .rightmost {
            border: 1px solid rgb(58, 58, 58);
        }
        .realReport2 {
            margin-top: 35px;
            page-break-before: always;
        }
        #origRow {
            border: none;
        }
        .leftmost {
            width: 20%;
        }
        .leftmost, .rightmost, .addScore, .addTopic {
            display: flex;
            justify-content: center;
            align-items: center;
        }
        .leftmid {
            width: 24%;
        }
        .rightmid {
            width: 7%;
        }
        .rightmost {
            width: 49%;
        }
        .trsRmrks {
            text-align: left;
        }
        .clearFloat {
            clear: both;
        }
        .leftmost, .leftmid, .rightmid, .rightmost {
            float: left;
        }
        .forHeading {
            max-height: 21px;
            border: none;
        }
        .forHeading .leftmid, .forHeading .rightmid {
            border: 1px solid rgb(58, 58, 58);
        }
        .addTopic, .addScore {
            font-size: 17px;
            line-height: 17px;
        }
        .forSubj {
            display: none;
        }
        .scoreKey, .sva {
            margin-top: 13px;
            width: 210mm;
        }
        .keyHeadings, .forHeading, .svaHeading {
            background-color: rgb(131, 131, 131);
        }
        .svaHeading, .svas {
            width: 100%;
        }
        .scoreKey, .scoreKey > div > div, .sva, .sva > div {
            display: inline-block;
            border: 1px solid rgb(58, 58, 58);
        }
        .leftKey, .midKey {
            width: 20%;
            float: left;
        }
        .rightKey {
            width: 60%;
        }
        .sva li {
            width: 49%;
            display: inline-block;
        }
        .sva li:nth-child(3n-1){
            background-color: rgb(196, 196, 196);
        }
        .sva li:nth-child(3n){
            background-color: rgb(157, 157, 157);
        }
        .reportOutros {
            text-align: left;
            margin-top: 10px;
            padding-left: 3px;
        }
        .reportIntros, .reportOutros {
            line-height: 130%;
        }
        .signOut > div {
            float: left;
        }
        .theSign {
            width: 80px;
            margin-top: 0;
            padding-top: 5px;
        }
        .populator {
            display: none;
        }
        .person1 {
            page-break-after: always;
        }
        .freeSpace {
            width: 50px;
            height: 14px;
        }
        .signHm {
            width: 50px;
            display: inline-block;
            vertical-align: bottom;
            margin-top: 2px;
        }
        .hdtrWord {
            width: 200px;
        }
    </style>
</head>
<body class="reportPage">
    <div class="person1">
        <div class="header">
            <img src="logoProgie.jpg" class="schLogo">
            <div class="holdTitl">
                <div class="firstLine">
                    PROGRESSIVE SECONDARY SCHOOL KASANA-LUWEERO
                </div>
                <div class="secLine">
                    progsskl@gmail.com</br>TEL: 0774205590, 0701433027, 0776455080, 0778236023
                </div>
            </div>
            <div class="clearFloat"></div>
            <div class="blackLine"></div>
            <div class="blackLine"></div>
        </div>
        <div class="reportIntros">
            <div class="reportWord">
                END OF TERM TWO 2023 REPORT CARD
            </div>
            <div class="theirName inlineB">
                NAME:
            </div><div class="addName inlineB"></div>
            <div class="theirClass inlineB">
                CLASS:
            </div><div class="addClass inlineB"></div>
            <div class="gender inlineB">
                GENDER:
            </div><div class="addGender inlineB"></div>
        </div>
        <div class="realReport inlineB">
            <div class="forHeading">
                <div class="leftmost">SUBJECT</div>
                <div class="leftmid">TOPIC</div>
                <div class="rightmid">SCORE</div>
                <div class="rightmost">TEACHER'S REMARKS</div>
                <div class="clearFloat"></div>
            </div>
            <div class="forSubj" id="origRow">
                <div class="subjName leftmost"></div>
                <div class="subjTopics leftmid">
                    
                </div>
                <div class="scoresNow rightmid">
                    
                </div>
                <div class="trsRmrks rightmost"></div>
                <div class="clearFloat"></div>
            </div>
        </div>
        <div class="scoreKey">
            <div class="keyHeadings">
                <div class="leftKey"><b>Identifier</b></div>
                <div class="midKey"><b>Score range</b></div>
                <div class="rightKey"><b>Descriptor</b></div>
            </div>
            <div class="keyBody">
                <div class="leftKey">3</div>
                <div class="midKey">2.5 - 3.0</div>
                <div class="rightKey"><b>Outstanding:</b> Most or all of Learning Outcomes achieved.</div>
                <div class="leftKey">2</div>
                <div class="midKey">1.5 - 2.4</div>
                <div class="rightKey"><b>Moderate:</b> Many of the Learning Outcomes achieved.</div>
                <div class="leftKey">1</div>
                <div class="midKey">0.9 - 1.4</div>
                <div class="rightKey"><b>Basic:</b> Few Learning Outcomes achieved, generally insufficient.</div>
            </div>
        </div>
        <div class="sva">
            <div class="svaHeading"><b>Observed Traits, Skills, Values and Attitudes</b></div>
            <div class="svas"><ul></ul></div>
        </div>
        <div class="reportOutros">
            <div class="nxtTerm">
                Next term begins on: 10th September, 2023
            </div>
            <div class="signOut">
                <div class="theSign">Signed:</div>
                <div><img src="nikSig.png" class="signHm"></div>
                <div class="clearFloat"></div>
                <div class="freeSpace"><br></div>
                <div class="hdtrWord">HEADTEACHER</div>
            </div>            
            <div class="teller"></div>
            <button class="populator" onclick="populate()">Populator</button>
        </div>
    </div>
    <script>    //THIS IS WHERE THE SCRIPT BEGINS   
        const ipcRenderer = window.theDataPath.renderer
        const strungArr = ipcRenderer.sendSync('bringArr')
        const allStrData = strungArr.split('endOut')
        const bodyWrdsData = []
        allStrData.forEach(el=>{
            bodyWrdsData.push(el.split('endIn'))
        })
        //console.log(bodyWrdsData)
        const subjsList = ['ENGLISH', 'PHYSICS', 'HISTORY', 'GEOGRAPHY', 'BIOLOGY', 'MATHEMATICS', 'CHEMISTRY', 'PHYSICAL EDUCATION', 'AGRICULTURE', 'ENTREPRENEURSHIP', 'ART', 'ICT', 'CRE', 'IRE', 'LUGANDA', 'LITERATURE', 'KISWAHILI']
        const topicsArrs = [['engtop1', 'engtop2','engtop3','engtop4'], 
        ['phytopp1', 'phytopp2', 'phytopp3', 'phytopp4'], 
        ['histtop1', 'histopp2', 'hoisnn'], 
        ['geogtoppp3', 'geogtop4', 'ihogdnn'], 
        ['bioltoppp5','bioltope6'], 
        ['mtctoppppp6', 'jsdfkjbd', 'lokmolkm lol'], 
        ['chemtopp7'], 
        ['pedtopp8', 'sdgsd'], 
        ['agrninth', 'agrtenth'], 
        ['ent11', 'entcomm'],
        ['snfkjvr', 'sdvvsgdg', 'yntrbrb'],
        ['dhybybf', 'untrvesv', 'wettbs'], 
        ['hbytdsew'], 
        [' hbtrer', 'ybtdsctv', 'brthgvve', 'btfourth comm']]
        const svaArr = ['Mathematical Computation', 'Communication', 'Creativity', 'Commitment', 'Critical Thinking', 'Cooperation', 'Self-directed learning','Problem solving', 'ICT proficiency', 'Logical thinking', 'Leadership', 'Empathy', 'Kindness', 'Sharing', 'Unnecessarily talkative', 'Generally stubborn', 'Often sleepy during class', 'Helpful', 'Disrupts normal order during class', 'Tends to be inactive']
        const commentsObj = {
            'ENGLISH': ['one', 'two','three', 'four', 'five'],
            'PHYSICS': ['one', 'two','three', 'four', 'five'],
            'ENTREPRENEURSHIP': ['one', 'two','three', 'four', 'five'],
            'LITERATURE': ['one', 'two','three', 'four', 'five'],
            'GEOGRAPHY': ['one', 'two','three', 'four', 'five'],
            'CHEMISTRY': ['one', 'two','three', 'four', 'five'],
            'MATHEMATICS': ['one', 'two','three', 'four', 'five'],
            'BIOLOGY': ['one', 'two','three', 'four', 'five'],
            'HISTORY': ['one', 'two','three', 'four', 'five'],
            'ICT': ['one', 'two','three', 'four', 'five'],
            'CRE': ['one', 'two','three', 'four', 'five'],
            'LUGANDA': ['one', 'two','three', 'four', 'five'],
            'KISWAHILI': ['one', 'two','three', 'four', 'five'],
            'IRE': ['one', 'two','three', 'four', 'five'],
            'PHYSICAL EDUCATION': ['one', 'two','three', 'four', 'five'],
            'ART': ['one', 'two','three', 'four', 'five'],
            'AGRICULTURE': ['one', 'two','three', 'four', 'five'],
        }
        function populate() {
            for (let i=1; i<bodyWrdsData.length; i++) {
                const repClone = document.querySelector('.person1').cloneNode(true)
                document.querySelector('body').appendChild(repClone)
            }
            //this code gives names, classes n genders (and shifts them from the array). will also work for old curriculum
            const reportIntros = ['addName', 'addClass', 'addGender']
            for (let r=0;r<reportIntros.length;r++) {
                for (let i=1; i<=bodyWrdsData.length; i++) {
                    const scoop = bodyWrdsData[i-1].shift()
                    const theTarget = document.querySelector(`body>div:nth-of-type(${i})`).querySelector(`.${reportIntros[r]}`)
                    theTarget.innerHTML = scoop
                }
            }
            //now the real populating. The loop below selects a particular learner
            for (let r=1;r<=bodyWrdsData.length;r++) {
                const voidSubjRow = document.querySelector(`body>div:nth-of-type(${r})`).querySelector('.forSubj')
                //the second realReport table
                const newTabl = document.createElement('div')
                newTabl.className = 'realReport2'
                newTabl.appendChild(document.querySelector(`body>div:nth-of-type(${r}) .forHeading`).cloneNode(true))
                //working on a single subject
                let pageToll = 0
                for (let b=0;b<topicsArrs.length;b++) {
                    const rowClone = voidSubjRow.cloneNode(true)
                    rowClone.querySelector('.subjName').innerHTML = subjsList[b]
                    let whetherWeAppend = false
                    let rowToll = 0
                    for (let dee=0;dee<topicsArrs[b].length;dee++){
                        if (topicsArrs[b][dee] && bodyWrdsData[r-1][4*b+dee]) {
                            const topicDiv = document.createElement('div')
                            topicDiv.classList.add('addTopic')
                            topicDiv.innerHTML = topicsArrs[b][dee]
                            rowClone.querySelector('.leftmid').appendChild(topicDiv)
                            const scoreDiv = document.createElement('div')
                            scoreDiv.classList.add('addScore')
                            scoreDiv.innerHTML = Math.round(+bodyWrdsData[r-1][4*b+dee],3)
                            rowClone.querySelector('.rightmid').appendChild(scoreDiv)
                            rowToll +=1
                            whetherWeAppend = true  
                        }
                    }    
                    if (whetherWeAppend) {
                        //determining the div heights
                        if (rowToll == 1) {
                            rowClone.querySelector('.leftmost').style.height = '84px'
                            rowClone.querySelector('.rightmost').style.height = '84px'
                            rowClone.querySelector('.addTopic').style.height = '84px'
                            rowClone.querySelector('.addScore').style.height = '84px'
                            pageToll +=2
                        } else {
                            rowClone.querySelector('.leftmost').style.height = `${rowToll*42}px`
                            rowClone.querySelector('.rightmost').style.height = `${rowToll*42}px`
                            rowClone.querySelectorAll('.addTopic').forEach(el=>el.style.height = '42px')
                            rowClone.querySelectorAll('.addScore').forEach(el=>el.style.height = '42px')
                            pageToll += rowToll
                        }
                        rowClone.querySelector(`.trsRmrks`).innerHTML = calcRmrks(rowClone.querySelectorAll('.addScore'), subjsList[b])
                        rowClone.style.display = 'block'
                        let destinatnTab = document.querySelector(`body>div:nth-of-type(${r})`).querySelector('.realReport')
                        if (pageToll>=24) {
                            destinatnTab = document.querySelector(`body>div:nth-of-type(${r}) .realReport`).insertAdjacentElement("afterend", newTabl)
                        }
                        destinatnTab.appendChild(rowClone) 
                    }
                }
                //removing the first forSubj which is empty
                voidSubjRow.remove()
                //observed skills, values n attitudes
                for(let d=68;d<bodyWrdsData[r-1].length;d++){//68 is the index of the first sva item. 4X17. This changes if the num of subjects changes
                    if(bodyWrdsData[r-1][d] == 1) {
                        const newSVA = document.createElement('li')
                        newSVA.innerHTML = svaArr[d-68]
                        document.querySelector(`body>div:nth-of-type(${r})`).querySelector(`.svas>ul`).appendChild(newSVA)
                    }
                }
            }
            nwReallyPrint() //Uncomment this function to really print
        }
        function calcRmrks (nodelis, subj) {
            let scores = []
            nodelis.forEach(el => {
                if (el.innerHTML) {
                    scores.push(el.innerHTML)
                }
            })
            let avg = 0
            for (let i=0;i<scores.length;i++) {
                avg += +scores[i]
            }
            avg = avg/scores.length
            let trsComm = ''
            if (avg < 1.3) {
                trsComm = commentsObj[subj][0]
            } else if (avg < 1.75) {
                trsComm = commentsObj[subj][1]
            } else if (avg < 2.2) {
                trsComm = commentsObj[subj][2]
            } else if (avg < 2.65) {
                trsComm = commentsObj[subj][3]
            } else if (avg > 2.65) {
                trsComm = commentsObj[subj][4]
            }
            return trsComm
        }
        //later, you can import the currbod from oldcurrtemp
        const ev = new MouseEvent("click")
        document.querySelector('.populator').dispatchEvent(ev)
        function nwReallyPrint() {
            const dateArr = Date().toString().split(' ')
                dateArr.splice(-4, 4)
                let filename = ''
                for (let i=0; i<dateArr.length;i++) {
                    filename+=dateArr[i]
                }
                ipcRenderer.send('doneLoading', filename)
        }
        //the UI teller. And it currently isnt showing output
        document.querySelector('.teller').addEventListener('printed', ()=> {
            document.querySelector('.teller').innerHTML = 'Printed successfully to ' + document.querySelector('.teller').dataset.message
            document.querySelector('.teller').style.display = 'flex'
            setTimeout(()=> {document.querySelector('.teller').style.display = 'none'}, 3000)
        })
        </script>
</body>
</html>