<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Report Template</title>
    <style>
        * {
            box-sizing: border-box;
            word-break: break-word;
        }
        button, .header, .section, .footer {
            user-select: none;
        }
        *:focus {
            outline: 3px solid rgb(0, 255, 128);
        }
        .reportPage {
            height: 330mm;
            width: 215mm;
            color: black;
            font-family: "Calibri", serif;
            font-size: 17px;
            text-align: center;
        }
        .header {
            font-weight: bolder;
            width: 190mm;
            max-height: 2.5cm;
            display: inline-block;
        }
        .schLogo {
            display: block;
            width: 65px;
            margin-left: 8px;
            margin-right: 15px;
            float: left;
        }
        .holdTitl {
            float: left;
        }
        .firstLine {
            font-size: 24px;
        }
        .blackLine {
            height: 3px;
            width: 100%;
            margin-bottom: 2px;
            border-top: 3px solid black;
        }
        .reportIntros, .reportOutros {
            font-weight: bold;
            width: 190mm;
            display: inline-block;
        }
        #notif {
            text-align: left;
            font-style: italic;
        }
        .inlineB {
            display: inline-block;
        }
        .addName {
            width: 83%;
            text-align: left;
        }
        .addClass, .addGender {
            width: 34%;
            height: 15px;
            text-align: left;
        }
        .theirName, .theirClass, .gender {
            width: 15%;
            text-align: left;
        }
        .realReport {
            width: 210mm;
            font-family: "Arial Narrow";
            text-align: center;
            border: 1px solid rgb(58, 58, 58);
        }
        .realReport >div, .addTopic, .addScore, .leftmost, .rightmost {
            border: 1px solid rgb(58, 58, 58);
        }
        #origRow {
            border: none;
        }
        .leftmost {
            width: 20%;
            height: 84px;
            padding-top: 10px;
        }
        .leftmid {
            width: 24%;
            height: 84px;
        }
        .leftmid > div, .rightmid > div {
            padding-top: 3px;
        }
        .rightmid {
            width: 7%;
            height: 84px;
        }
        .rightmost {
            /*padding-top: 14px;*/
            width: 49%;
            height: 84px;
        }
        .trsRmrks {
            text-align: left;
        }
        .noPad {
            padding-top: 0px;
        }
        .clearFloat {
            clear: both;
        }
        .leftmost, .leftmid, .rightmid, .rightmost {
            float: left;
        }
        .forHeading {
            max-height: 21px;
            border: none;
            overflow:hidden; /*the child divs are the height of the forsubj div*/
        }
        .forHeading > div {
            border: 1px solid rgb(58, 58, 58);
        }
        .addTopic, .addScore {
            height: 42px;
            font-size: 17px;
            line-height: 17px;
        }
        .forSubj {
            display: none;
        }
        .scoreKey, .sva {
            margin-top: 13px;
            width: 210mm;
        }
        .keyHeadings, .forHeading, .svaHeading {
            background-color: rgb(131, 131, 131);
        }
        .svaHeading, .svas {
            width: 100%;
        }
        .scoreKey, .scoreKey > div > div, .sva, .sva > div {
            display: inline-block;
            border: 1px solid rgb(58, 58, 58);
        }
        .leftKey, .midKey {
            width: 20%;
            float: left;
        }
        .rightKey {
            width: 60%;
        }
        .sva li {
            width: 49%;
            display: inline-block;
        }
        .sva li:nth-child(3n-1){
            background-color: rgb(196, 196, 196);
        }
        .sva li:nth-child(3n){
            background-color: rgb(157, 157, 157);
        }
        .reportOutros {
            text-align: left;
            margin-top: 10px;
            padding-left: 3px;
        }
        .signOut > div {
            float: left;
        }
        .theSign {
            width: 80px;
            margin-top: 0;
            padding-top: 5px;
        }
        .populator {
            display: none;
        }
        .person1 {
            page-break-after: always;
        }
        .freeSpace {
            width: 50px;
            height: 14px;
        }
        .signHm {
            width: 50px;
            display: inline-block;
            vertical-align: bottom;
            margin-top: 2px;
        }
        .hdtrWord {
            width: 120px;
        }
    </style>
</head>
<body class="reportPage">
    <div class="person1">
        <div class="header">
            <img src="logoProgie.jpg" class="schLogo">
            <div class="holdTitl">
                <div class="firstLine">
                    PROGRESSIVE SECONDARY SCHOOL KASANA-LUWEERO
                </div>
                <div class="secLine">
                    progsskl@gmail.com</br>TEL: 0774205590, 0701433027, 0776455080, 0778236023
                </div>
            </div>
            <div class="clearFloat"></div>
            <div class="blackLine"></div>
            <div class="blackLine"></div>
        </div>
        <div class="reportIntros">
            <div class="reportWord">
                END OF TERM TWO 2023 REPORT CARD
            </div>
            <div class="theirName inlineB">
                NAME:
            </div><div class="addName inlineB"></div>
            <div class="theirClass inlineB">
                CLASS:
            </div><div class="addClass inlineB"></div>
            <div class="gender inlineB">
                GENDER:
            </div><div class="addGender inlineB"></div>
        </div>
        <div class="realReport inlineB">
            <div class="forHeading">
                <div class="leftmost noPad">SUBJECT</div>
                <div class="leftmid">TOPIC</div>
                <div class="rightmid">SCORE</div>
                <div class="rightmost noPad">TEACHER'S REMARKS</div>
                <div class="clearFloat"></div>
            </div>
            <div class="forSubj" id="origRow">
                <div class="subjName leftmost"></div>
                <div class="subjTopics leftmid">
                    <div class="addTopic"></div>
                    <div class="addTopic"></div>
                </div>
                <div class="scoresNow rightmid">
                    <div class="addScore"></div>
                    <div class="addScore"></div>
                </div>
                <div class="trsRmrks rightmost"></div>
            </div>
        </div>
        <div class="scoreKey">
            <div class="keyHeadings">
                <div class="leftKey"><b>Identifier</b></div>
                <div class="midKey"><b>Score range</b></div>
                <div class="rightKey"><b>Descriptor</b></div>
            </div>
            <div class="keyBody">
                <div class="leftKey">3</div>
                <div class="midKey">2.5 - 3.0</div>
                <div class="rightKey"><b>Outstanding:</b> Most or all of Learning Outcomes achieved.</div>
                <div class="leftKey">2</div>
                <div class="midKey">1.5 - 2.4</div>
                <div class="rightKey"><b>Moderate:</b> Many of the Learning Outcomes achieved.</div>
                <div class="leftKey">1</div>
                <div class="midKey">0.9 - 1.4</div>
                <div class="rightKey"><b>Basic:</b> Few Learning Outcomes achieved, generally insufficient.</div>
            </div>
        </div>
        <div class="sva">
            <div class="svaHeading"><b>Observed Traits, Skills, Values and Attitudes</b></div>
            <div class="svas"><ul></ul></div>
        </div>
        <div class="reportOutros">
            <div class="nxtTerm">
                Next term begins on: 16th September, 2023
            </div>
            <div class="classTr">
            </div>
            <div class="signOut">
                <div class="theSign">Signed:</div>
                <div><img src="nikSig.png" class="signHm"></div>
                <div class="clearFloat"></div>
                <div class="freeSpace"><br></div>
                <div class="hdtrWord">HEADTEACHER</div>
            </div>            
            <div class="teller"></div>
            <button class="populator" onclick="populate()">Populator</button>
        </div>
        <script>
            const ipcRenderer = window.theDataPath.renderer
            const strungArr = ipcRenderer.sendSync('bringArr')
            const allStrData = strungArr.split('endOut')
            const headWrdsData = allStrData.shift().split('endIn')
            const bodyWrdsData = []
            allStrData.forEach(el=>{
                bodyWrdsData.push(el.split('endIn'))
            })
            console.log(headWrdsData)
            console.log(bodyWrdsData)
            function populate() {
                for (let i=1; i<bodyWrdsData.length; i++) {
                    const repClone = document.querySelector('.person1').cloneNode(true)
                    document.querySelector('body').appendChild(repClone)
                }
                //this code gives names, classes n genders. will also work for old curriculum
                const reportIntros = ['addName', 'addClass', 'addGender']
                for (let r=0;r<reportIntros.length;r++) {
                    for (let i=1; i<=bodyWrdsData.length; i++) {
                        const scoop = bodyWrdsData[i-1].shift()
                        const theTarget = document.querySelector(`body>div:nth-of-type(${i})`).querySelector(`.${reportIntros[r]}`)
                        theTarget.innerHTML = scoop
                    }
                    headWrdsData.shift()
                }
                const subjList = ['ENGLISH', 'PHYSICS', 'HISTORY', 'GEOGRAPHY', 'BIOLOGY', 'MATHEMATICS', 'CHEMISTRY', 'PHYSICAL EDUCATION', 'AGRICULTURE', 'ENTREPRENEURSHIP', 'ART', 'I.C.T', 'C.R.E', 'I.R.E', 'LUGANDA', 'LITERATURE', 'KISWAHILI']
                //now the real populating. The loop below selects a particular learner
                for (let r=1;r<=bodyWrdsData.length;r++) {
                    const voidSubjRow = document.querySelector(`body>div:nth-of-type(${r})`).querySelector('.forSubj')
                    for (let c=1;c<=subjList.length;c++){
                        if (bodyWrdsData[r-1][c*2-2]) {
                            const rowClone = voidSubjRow.cloneNode(true)
                            rowClone.querySelector('.subjName').innerHTML = subjList[c-1]
                            rowClone.querySelector('.addTopic:nth-of-type(1)').innerHTML = headWrdsData[c*2-2]
                            rowClone.querySelector('.addTopic:nth-of-type(2)').innerHTML = headWrdsData[c*2-1]
                            rowClone.querySelector('.addScore:nth-of-type(1)').innerHTML = bodyWrdsData[r-1][c*2-2]
                            rowClone.querySelector('.addScore:nth-of-type(2)').innerHTML = bodyWrdsData[r-1][c*2-1]
                            rowClone.querySelector('.trsRmrks').innerHTML = bodyWrdsData[r-1][c+33] //we have 34 score columns
                            rowClone.style.display = 'block'
                            document.querySelector(`body>div:nth-of-type(${r})`).querySelector('.realReport').appendChild(rowClone) 
                        }
                    }
                    //observed skills, values n attitudes
                    for(let d=51;d<bodyWrdsData[r-1].length;d++){//51 is the index of the first sva item
                        if(bodyWrdsData[r-1][d] != 'False' && bodyWrdsData[r-1][d] != '0') {
                            newSVA = document.createElement('li')
                            newSVA.innerHTML = headWrdsData[d]
                            document.querySelector(`body>div:nth-of-type(${r})`).querySelector(`.svas>ul`).appendChild(newSVA)
                        }
                    }
                }
                nwReallyPrint() //Uncomment this function to really print
            }
            //later, you can import the currbod from oldcurrtemp
            const ev = new MouseEvent("click")
            document.querySelector('.populator').dispatchEvent(ev)
            function nwReallyPrint() {
                const dateArr = Date().toString().split(' ')
                    dateArr.splice(-4, 4)
                    let filename = ''
                    for (let i=0; i<dateArr.length;i++) {
                        filename+=dateArr[i]
                    }
                    ipcRenderer.send('doneLoading', filename)
            }
            //the UI teller. And it currently isnt showing output
            document.querySelector('.teller').addEventListener('printed', ()=> {
                document.querySelector('.teller').innerHTML = 'Printed successfully to ' + document.querySelector('.teller').dataset.message
                document.querySelector('.teller').style.display = 'flex'
                setTimeout(()=> {document.querySelector('.teller').style.display = 'none'}, 3000)
            })
        </script>
    </div>
</body>
</html>